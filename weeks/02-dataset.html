
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Week 2 Notebook: Data Formats and Exploration &#8212; Particle Physics and Machine Learning</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Week 3: Feature Engineering" href="03.html" />
    <link rel="prev" title="Week 2: Data Formats and Exploration" href="02.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Particle Physics and Machine Learning</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   Particle Physics and Machine Learning
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01.html">
   Week 1: Introduction to Particle Physics and Jets
  </a>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="02.html">
   Week 2: Data Formats and Exploration
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Week 2 Notebook: Data Formats and Exploration
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="03.html">
   Week 3: Feature Engineering
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="03-features.html">
     Week 3 Notebook: Feature Engineering
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="04.html">
   Week 4: Simple Classifiers
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="04-simple-classifiers.html">
     Week 4 Notebook: Simple Classifiers
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="05.html">
   Week 5: Building a Deep Learning Model
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="05-deep-learning.html">
     Week 5 Notebook: Building a Deep Learning Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05-jet-images.html">
     Week 5 Notebook: Deep Learning from Jet Images
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="06.html">
   Week 6: Evalulating Model Performance and Robustness
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="06-evaluate.html">
     Week 6 Notebook: Evalulating Model Performance and Robustness
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="07.html">
   Week 7: Optimizing Other Objectives
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="07-objectives.html">
     Week 7 Notebook: Optimizing Other Objectives
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="08.html">
   Week 8: Extending the Model
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="08-extending.html">
     Week 8 Notebook: Extending the Model
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09.html">
   Week 9: Application to Real Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../zreferences.html">
   References
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/weeks/02-dataset.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/jmduarte/capstone-particle-physics-domain"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/jmduarte/capstone-particle-physics-domain/issues/new?title=Issue%20on%20page%20%2Fweeks/02-dataset.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/jmduarte/capstone-particle-physics-domain/edit/master/weeks/02-dataset.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/jmduarte/capstone-particle-physics-domain/master?urlpath=tree/weeks/02-dataset.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://datahub.ucsd.edu/hub/user-redirect/git-pull?repo=https://github.com/jmduarte/capstone-particle-physics-domain&urlpath=tree/capstone-particle-physics-domain/weeks/02-dataset.ipynb&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#remote-files">
   Remote files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#xrootd-filenames">
   XRootD filenames
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trees">
   Trees
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-note-on-jaggedness">
   A note on “jaggedness”
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-the-signal-and-background">
   What is the signal and background?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#jagged-arrys">
   Jagged arrys
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#operations-with-jaggedness">
   Operations with jaggedness
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conversion-to-regular-array">
   Conversion to regular array
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="week-2-notebook-data-formats-and-exploration">
<h1>Week 2 Notebook: Data Formats and Exploration<a class="headerlink" href="#week-2-notebook-data-formats-and-exploration" title="Permalink to this headline">¶</a></h1>
<p>Particle physics uses a data format (and analysis ecosystem) based on the <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> library: https://root.cern.ch/.
<code class="docutils literal notranslate"><span class="pre">ROOT</span></code> is a framework for data processing, born at CERN, at the heart of the research on high-energy physics.
A <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> file is a compressed binary file in which we can save objects of any type.
There are python bindings built into <code class="docutils literal notranslate"><span class="pre">ROOT</span></code>, so called <code class="docutils literal notranslate"><span class="pre">PyROOT</span></code>, but for now we won’t discuss this.</p>
<p>Recently, a different library called <code class="docutils literal notranslate"><span class="pre">uproot</span></code> has been developed allowing python users to do <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> I/O directly: https://uproot.readthedocs.io/en/latest/.
<code class="docutils literal notranslate"><span class="pre">uproot</span></code> is a reader and a writer of the <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> file format using only <code class="docutils literal notranslate"><span class="pre">Python</span></code> and <code class="docutils literal notranslate"><span class="pre">Numpy</span></code>.
Unlike the standard C++ <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> implementation, uproot is only an I/O library, primarily intended to stream data into machine learning libraries in <code class="docutils literal notranslate"><span class="pre">Python</span></code>.
Unlike <code class="docutils literal notranslate"><span class="pre">PyROOT</span></code> and <code class="docutils literal notranslate"><span class="pre">root_numpy</span></code>, uproot does not depend on C++ <code class="docutils literal notranslate"><span class="pre">ROOT</span></code>.
Instead, it uses <code class="docutils literal notranslate"><span class="pre">Numpy</span></code> to cast blocks of data from the <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> file as <code class="docutils literal notranslate"><span class="pre">Numpy</span></code> arrays.
It can also make jagged or awkward arrays based on this library: https://github.com/scikit-hep/awkward-1.0 <a class="bibtex reference internal" href="../zreferences.html#pivarski-2020qcb" id="id1">[4]</a>.</p>
<p>For a tutorial on <code class="docutils literal notranslate"><span class="pre">uproot</span></code>, see: https://hsf-training.github.io/hsf-training-uproot-webpage/ or here: https://github.com/jpivarski-talks/2020-07-13-pyhep2020-tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">uproot</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="remote-files">
<h2>Remote files<a class="headerlink" href="#remote-files" title="Permalink to this headline">¶</a></h2>
<p>One nice feature of <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> and <code class="docutils literal notranslate"><span class="pre">uproot</span></code> is the ability to read a file remotely.
This is done using the <code class="docutils literal notranslate"><span class="pre">XRootD</span></code> library: https://xrootd.slac.stanford.edu/.
<code class="docutils literal notranslate"><span class="pre">XRootD</span></code> is a generic suite for fast, low latency and scalable data access, which can serve natively any kind of data, organized as a hierarchical filesystem-like namespace, based on the concept of directory.</p>
</div>
<div class="section" id="xrootd-filenames">
<h2>XRootD filenames<a class="headerlink" href="#xrootd-filenames" title="Permalink to this headline">¶</a></h2>
<p>We specify that this is a remote file accessed via <code class="docutils literal notranslate"><span class="pre">XRootD</span></code> using the <code class="docutils literal notranslate"><span class="pre">root://</span></code> protocol in front of the filename.
The redirector <code class="docutils literal notranslate"><span class="pre">eospublic.cern.ch</span></code> specifies that we’re accessing data from the CERN open data repository.
And finally the rest of the file name <code class="docutils literal notranslate"><span class="pre">/eos/opendata/cms/datascience/HiggsToBBNtupleProducerTool/HiggsToBBNTuple_HiggsToBB_QCD_RunII_13TeV_MC/train/ntuple_merged_10.root</span></code> specifies the exact file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">uproot</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;root://eospublic.cern.ch//eos/opendata/cms/datascience/HiggsToBBNtupleProducerTool/HiggsToBBNTuple_HiggsToBB_QCD_RunII_13TeV_MC/train/ntuple_merged_10.root&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="trees">
<h2>Trees<a class="headerlink" href="#trees" title="Permalink to this headline">¶</a></h2>
<p>One common object is a tree.
Trees in <code class="docutils literal notranslate"><span class="pre">ROOT</span></code> are basically just tables of information.
Trees are composed of branches, which are the columns of the table.
The rows usually represent events (individual bunch crossings).
However, in this case, each row represents a jet (a localized collection of particles within a single event).</p>
<p>First we assign the tree to a variable (named <code class="docutils literal notranslate"><span class="pre">tree</span></code> here).
We can see how many rows (jets) are contained in the tree, by checking its length.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;deepntuplizer/tree&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>219
</pre></div>
</div>
</div>
</div>
<p>Let’s list the contents (branches) of the tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>name                 | typename                 | interpretation                
---------------------+--------------------------+-------------------------------
Delta_gen_pt         | float                    | AsDtype(&#39;&gt;f4&#39;)
event_no             | uint32_t                 | AsDtype(&#39;&gt;u4&#39;)
gen_pt               | float                    | AsDtype(&#39;&gt;f4&#39;)
isB                  | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
isBB                 | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
isC                  | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
isG                  | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
isLeptonicB          | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
isLeptonicB_C        | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
isS                  | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
isUD                 | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
isUndefined          | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
jet_corr_pt          | float                    | AsDtype(&#39;&gt;f4&#39;)
jet_eta              | float                    | AsDtype(&#39;&gt;f4&#39;)
jet_looseId          | float                    | AsDtype(&#39;&gt;f4&#39;)
jet_no               | uint32_t                 | AsDtype(&#39;&gt;u4&#39;)
jet_phi              | float                    | AsDtype(&#39;&gt;f4&#39;)
jet_pt               | float                    | AsDtype(&#39;&gt;f4&#39;)
jet_tightId          | float                    | AsDtype(&#39;&gt;f4&#39;)
npv                  | float                    | AsDtype(&#39;&gt;f4&#39;)
ntrueInt             | float                    | AsDtype(&#39;&gt;f4&#39;)
pfBoostedDoubleSe... | float                    | AsDtype(&#39;&gt;f4&#39;)
pfCombinedInclusi... | float                    | AsDtype(&#39;&gt;f4&#39;)
pfCombinedMVAV2BJ... | float                    | AsDtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_... | float                    | AsDtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_... | float                    | AsDtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_... | float                    | AsDtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_... | float                    | AsDtype(&#39;&gt;f4&#39;)
pfDeepCSVJetTags_... | float                    | AsDtype(&#39;&gt;f4&#39;)
pfJetBProbability... | float                    | AsDtype(&#39;&gt;f4&#39;)
pfJetProbabilityB... | float                    | AsDtype(&#39;&gt;f4&#39;)
rho                  | float                    | AsDtype(&#39;&gt;f4&#39;)
softPFElectronBJe... | float                    | AsDtype(&#39;&gt;f4&#39;)
softPFMuonBJetTags   | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_doubleb           | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_eta               | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_gen_eta           | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_gen_pt            | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_isBB              | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_isH               | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_isNonBB           | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_isQCD             | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_isTop             | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_isW               | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_isZ               | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_jetNTracks        | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_label             | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_labelJMAR         | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_labelLegacy       | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_mass              | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_nSV               | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_n_sdsubjets       | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_nbHadrons         | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_ncHadrons         | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
fj_phi               | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_pt                | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_ptDR              | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_relptdiff         | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdmass            | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdn2              | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj1_axis1       | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj1_axis2       | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj1_csv         | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj1_eta         | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj1_mass        | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj1_mult        | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj1_phi         | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj1_pt          | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj1_ptD         | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj2_axis1       | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj2_axis2       | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj2_csv         | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj2_eta         | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj2_mass        | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj2_mult        | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj2_phi         | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj2_pt          | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_sdsj2_ptD         | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau0_trackEtaR... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau0_trackEtaR... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau0_trackEtaR... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau1              | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau1_trackEtaR... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau1_trackEtaR... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau1_trackEtaR... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau2              | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau21             | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau3              | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau32             | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau_flightDist... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau_flightDist... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau_vertexDelt... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau_vertexEner... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau_vertexEner... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau_vertexMass_0  | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_tau_vertexMass_1  | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSip2dSigA... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSip2dSigA... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSip2dSigA... | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_0    | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_0_0  | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_0_1  | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_1    | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_1_0  | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_1_1  | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_2    | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_trackSipdSig_3    | float                    | AsDtype(&#39;&gt;f4&#39;)
fj_z_ratio           | float                    | AsDtype(&#39;&gt;f4&#39;)
label_H_bb           | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_H_cc           | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_H_qqqq         | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_QCD_b          | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_QCD_bb         | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_QCD_c          | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_QCD_cc         | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_QCD_others     | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_Top_bc         | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_Top_bcq        | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_Top_bq         | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_Top_bqq        | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_W_cq           | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_W_qq           | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_Z_bb           | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_Z_cc           | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
label_Z_qq           | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
sample_isQCD         | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
n_pfcands            | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
npfcands             | float                    | AsDtype(&#39;&gt;f4&#39;)
pfcand_VTX_ass       | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_charge        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_deltaR        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_drminsv       | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_drsubjet1     | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_drsubjet2     | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_dxy           | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_dxysig        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_dz            | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_dzsig         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_erel          | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_etarel        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_fromPV        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_hcalFrac      | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_isChargedHad  | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_isEl          | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_isGamma       | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_isMu          | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_isNeutralHad  | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_lostInnerHits | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_mass          | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_phirel        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_ptrel         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
pfcand_puppiw        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
n_tracks             | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
ntracks              | float                    | AsDtype(&#39;&gt;f4&#39;)
trackBTag_DeltaR     | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_Eta        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_EtaRel     | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_JetDistVal | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_Momentum   | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_PPar       | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_PParRatio  | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_PtRatio    | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_PtRel      | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_Sip2dSig   | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_Sip2dVal   | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_Sip3dSig   | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
trackBTag_Sip3dVal   | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_VTX_ass        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_charge         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_deltaR         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_detadeta       | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dlambdadz      | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dphidphi       | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dphidxy        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dptdpt         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_drminsv        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_drsubjet1      | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_drsubjet2      | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dxy            | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dxydxy         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dxydz          | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dxysig         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dz             | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dzdz           | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_dzsig          | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_erel           | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_etarel         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_fromPV         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_isChargedHad   | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_isEl           | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_isMu           | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_lostInnerHits  | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_mass           | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_normchi2       | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_phirel         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_pt             | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_ptrel          | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_puppiw         | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
track_quality        | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
n_sv                 | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
nsv                  | float                    | AsDtype(&#39;&gt;f4&#39;)
sv_chi2              | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_costhetasvpv      | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_d3d               | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_d3derr            | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_d3dsig            | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_deltaR            | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_dxy               | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_dxyerr            | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_dxysig            | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_erel              | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_etarel            | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_mass              | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_ndf               | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_normchi2          | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_ntracks           | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_phirel            | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_pt                | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
sv_ptrel             | std::vector&lt;float&gt;       | AsJagged(AsDtype(&#39;&gt;f4&#39;), he...
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-note-on-jaggedness">
<h2>A note on “jaggedness”<a class="headerlink" href="#a-note-on-jaggedness" title="Permalink to this headline">¶</a></h2>
<p>Some branches are listed has having an interpretation of <code class="docutils literal notranslate"><span class="pre">asdtype('&gt;f4')</span></code> while some others are listed as <code class="docutils literal notranslate"><span class="pre">asjagged(asdtype('&gt;f4'),</span> <span class="pre">10)</span></code>.
The former means there is only one number per jet.
The latter means there may a variable number per jet.</p>
<p>First, let’s get just look at non-jagged arrays, starting with the ground truth labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a dictionary</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">branches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;label_QCD_b&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_QCD_bb&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_QCD_c&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_QCD_cc&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_QCD_others&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;label_H_bb&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;sample_isQCD&#39;</span><span class="p">],</span> 
                     <span class="n">entrystop</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
                     <span class="n">namedecode</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">ecfdc5e5b8e9</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>                                <span class="s1">&#39;sample_isQCD&#39;</span><span class="p">],</span> 
<span class="g g-Whitespace">      </span><span class="mi">9</span>                      <span class="n">entrystop</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
<span class="ne">---&gt; </span><span class="mi">10</span>                      <span class="n">namedecode</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">labels</span>

<span class="ne">TypeError</span>: arrays() got an unexpected keyword argument &#39;branches&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># label QCD: require the sample to be QCD and any of the QCD flavors</span>
<span class="n">label_QCD</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;sample_isQCD&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_b&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                      <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_bb&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                      <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_c&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                      <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_cc&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                      <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_QCD_others&#39;</span><span class="p">])</span>

<span class="c1"># label Hbb</span>
<span class="n">label_Hbb</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="s1">&#39;label_H_bb&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="what-is-the-signal-and-background">
<h2>What is the signal and background?<a class="headerlink" href="#what-is-the-signal-and-background" title="Permalink to this headline">¶</a></h2>
<p>Signal (Higgs) events for this task look like this:</p>
<div class="math notranslate nohighlight">
\[gg \to X\to HH \to b\bar{b}b\bar{b}\]</div>
<img width = 400px src="http://cms-results.web.cern.ch/cms-results/public-results/publications/B2G-17-006/CMS-B2G-17-006_Figure_001-a.png"/>
<p>Background (QCD) events for this task look like this:</p>
<div class="math notranslate nohighlight">
\[gg \to q \bar{q} / gg / b\bar{b} / gb\bar{b} / ggg / \cdots\]</div>
<img width = 400px src="https://www.physik.uzh.ch/~che/FeynDiag/diagrams/1_pp_scattering/10000013.png"/>
<p>We will look at differentiating signal and background at the “jet” level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># number of overlap jets</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">label_QCD</span><span class="o">*</span><span class="n">label_Hbb</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fraction of jets with some truth label defined </span>
<span class="nb">sum</span><span class="p">(</span><span class="n">label_QCD</span><span class="o">+</span><span class="n">label_Hbb</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">label_QCD</span><span class="o">+</span><span class="n">label_Hbb</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># jet features, namely transverse momemntum (pt) and soft-drop mass  (sdmass or msd)</span>
<span class="n">jet_features</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">branches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fj_pt&#39;</span><span class="p">,</span> 
                                     <span class="s1">&#39;fj_sdmass&#39;</span><span class="p">],</span>
                          <span class="n">entrystop</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
                          <span class="n">namedecode</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_pt&#39;</span><span class="p">],</span><span class="n">weights</span><span class="o">=</span><span class="n">label_QCD</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;QCD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_pt&#39;</span><span class="p">],</span><span class="n">weights</span><span class="o">=</span><span class="n">label_Hbb</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;H(bb)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Jet $p_</span><span class="si">{T}</span><span class="s1">$ [GeV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of jets&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_sdmass&#39;</span><span class="p">],</span><span class="n">weights</span><span class="o">=</span><span class="n">label_QCD</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;QCD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_sdmass&#39;</span><span class="p">],</span><span class="n">weights</span><span class="o">=</span><span class="n">label_Hbb</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;H(bb)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Jet $m_</span><span class="si">{SD}</span><span class="s1">$ [GeV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of jets&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="jagged-arrys">
<h2>Jagged arrys<a class="headerlink" href="#jagged-arrys" title="Permalink to this headline">¶</a></h2>
<p>Now let’s look at a jagged array, like those related to track features, where there can be a variable number of tracks per jet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">branches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;label_H_bb&#39;</span><span class="p">],</span>
                             <span class="n">entrystop</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span>
                             <span class="n">namedecode</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">track_features</span>
</pre></div>
</div>
</div>
</div>
<p>Note the difference between a “flat” array, where these a fixed number per jet (like 1 per jet in the case of jet properties) and a jagged array, where there are a variable number.</p>
<p>We can demonstrate this by looking at the first jet in the dataset. As we’ll see there are 21 tracks, each with their own pt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jet_features</span><span class="p">[</span><span class="s1">&#39;fj_pt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Note, behind the scenes jagged arrays are just like normal numpy arrays, except there’s additional structure, ecoded in the starts/stops/counts vectors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">starts</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stops</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">counts</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="operations-with-jaggedness">
<h2>Operations with jaggedness<a class="headerlink" href="#operations-with-jaggedness" title="Permalink to this headline">¶</a></h2>
<p>We can plot the full distibution of track pts. But what if we want to find the highest track pt per jet and plot only that?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;All tracks&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Max. $p_</span><span class="si">{T}</span><span class="s1">$ track per jet&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Track $p_</span><span class="si">{T}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of tracks&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="conversion-to-regular-array">
<h2>Conversion to regular array<a class="headerlink" href="#conversion-to-regular-array" title="Permalink to this headline">¶</a></h2>
<p>Sometimes we want to turn a jagged array into a regular array to make it easier to accomodate into a machine learning algorithm (like a fully conneted or convolutional neural network).
The simplest way to do this is to use zero-padding and truncation to “cap” the number of objects at some fixed value, and zero-pad if there are less objects.</p>
<p>To do this, we can first plot how many tracks there are per jet and choose a reasonable number to cap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">counts</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">),</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Number of tracks&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of jets&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In this case, 60 seems to be a reasonable number.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">track_features</span><span class="p">[</span><span class="s1">&#39;track_pt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">regular</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">a</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./weeks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="02.html" title="previous page">Week 2: Data Formats and Exploration</a>
    <a class='right-next' id="next-link" href="03.html" title="next page">Week 3: Feature Engineering</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Javier Duarte and Frank Würthwein<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>